{% extends 'base.html' %}
{% load static %}

{% block title %}Messages | UrbanMD Health Network{% endblock %}

{% block page_title %}Messages{% endblock %}

{% block content %}
<div class="h-[calc(100vh-12rem)] flex flex-col md:flex-row gap-6">
    <!-- Conversation List -->
    <div class="w-full md:w-80 lg:w-96 bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input type="text" placeholder="Search messages" class="pl-10 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm">
            </div>
        </div>
        <div class="h-[calc(100vh-16rem)] overflow-y-auto">
            <ul class="divide-y divide-gray-200 dark:divide-gray-700">
                <!-- Conversation Item - Active -->
                <li class="bg-blue-50 dark:bg-blue-900/20">
                    <a href="#" class="block hover:bg-blue-50 dark:hover:bg-blue-900/20 focus:outline-none">
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Dr. Sarah Johnson</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Cardiology</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">10:23 AM</span>
                                    <span class="mt-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300">
                                        New
                                    </span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-600 dark:text-gray-300 truncate">Thank you for sending your blood pressure readings. I'd like to discuss adjusting your medication...</p>
                            </div>
                        </div>
                    </a>
                </li>

                <!-- Conversation Item -->
                <li>
                    <a href="#" class="block hover:bg-gray-50 dark:hover:bg-gray-700/30 focus:outline-none">
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600 dark:text-purple-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Dr. Michael Chen</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Dermatology</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Yesterday</span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-600 dark:text-gray-300 truncate">Your lab results came back normal. Continue with the prescribed medication for two more weeks...</p>
                            </div>
                        </div>
                    </a>
                </li>

                <!-- Conversation Item -->
                <li>
                    <a href="#" class="block hover:bg-gray-50 dark:hover:bg-gray-700/30 focus:outline-none">
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600 dark:text-green-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Pharmacy Service</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Support Team</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">May 3</span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-600 dark:text-gray-300 truncate">Your prescription refill has been processed. It will be ready for pickup tomorrow after 2 PM...</p>
                            </div>
                        </div>
                    </a>
                </li>

                <!-- Conversation Item -->
                <li>
                    <a href="#" class="block hover:bg-gray-50 dark:hover:bg-gray-700/30 focus:outline-none">
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600 dark:text-yellow-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Appointment Team</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Scheduling</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Apr 28</span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-600 dark:text-gray-300 truncate">Your appointment with Dr. Williams has been confirmed for May 15th at 2:30 PM. Please arrive 15 minutes...</p>
                            </div>
                        </div>
                    </a>
                </li>

                <!-- Conversation Item -->
                <li>
                    <a href="#" class="block hover:bg-gray-50 dark:hover:bg-gray-700/30 focus:outline-none">
                        <div class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600 dark:text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Dr. Emily Rodriguez</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">Psychiatry</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Apr 15</span>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-sm text-gray-600 dark:text-gray-300 truncate">Thank you for our session today. I've attached some resources on stress management techniques we discussed...</p>
                            </div>
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Message Thread / Chat Window -->
    <div class="hidden md:flex flex-col flex-1 bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
        <!-- Thread Header -->
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-900 dark:text-white">Dr. Sarah Johnson</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Cardiology</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <button class="inline-flex items-center p-1.5 border border-gray-300 dark:border-gray-600 rounded-full shadow-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all" title="Video Call">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                </button>
                <button class="inline-flex items-center p-1.5 border border-gray-300 dark:border-gray-600 rounded-full shadow-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all" title="Options">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Messages Container -->
        <div class="flex-1 p-6 overflow-y-auto">
            <div class="space-y-6">
                <!-- Date Separator -->
                <div class="flex justify-center">
                    <span class="px-4 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs font-medium text-gray-500 dark:text-gray-400">
                        Today, May 5, 2025
                    </span>
                </div>

                <!-- Message - Received -->
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <div class="ml-3 bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-3 max-w-md">
                        <p class="text-sm text-gray-900 dark:text-white">Good morning! I've reviewed the blood pressure readings you sent through the app. I've noticed that your systolic pressure has been slightly elevated over the past week. How are you feeling overall?</p>
                        <span class="mt-1 text-xs text-gray-500 dark:text-gray-400">10:15 AM</span>
                    </div>
                </div>

                <!-- Message - Sent -->
                <div class="flex items-start justify-end">
                    <div class="bg-blue-600 dark:bg-blue-700 rounded-lg px-4 py-3 max-w-md">
                        <p class="text-sm text-white">Good morning, Dr. Johnson. I've been feeling mostly fine, but I did notice I've been having some mild headaches in the morning. I've been trying to reduce my salt intake as you suggested last time.</p>
                        <span class="mt-1 text-xs text-blue-200">10:18 AM</span>
                    </div>
                </div>

                <!-- Message - Received -->
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <div class="ml-3 bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-3 max-w-md">
                        <p class="text-sm text-gray-900 dark:text-white">Thank you for that information. The headaches might be related to the blood pressure changes. I think we should consider adjusting your medication slightly. I'm going to increase your dosage of lisinopril from 10mg to 20mg once daily. This should help bring your systolic pressure down to a more optimal range. How does that sound?</p>
                        <span class="mt-1 text-xs text-gray-500 dark:text-gray-400">10:23 AM</span>
                    </div>
                </div>

                <!-- Message with Attachment - Received -->
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <div class="ml-3 bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-3 max-w-md">
                        <p class="text-sm text-gray-900 dark:text-white">I'm also sending you an updated prescription and a PDF guide on lifestyle changes that can help with blood pressure management.</p>
                        <div class="mt-2 bg-white dark:bg-gray-600 rounded-md p-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">Blood Pressure Management Guide.pdf</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">2.4 MB</p>
                            </div>
                            <button class="ml-auto p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                </svg>
                            </button>
                        </div>
                        <span class="mt-1 text-xs text-gray-500 dark:text-gray-400">10:25 AM</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Input -->
        <div class="border-t border-gray-200 dark:border-gray-700 px-6 py-4">
            <div class="flex items-end">
                <div class="flex-1">
                    <textarea rows="1" placeholder="Type your message..." class="block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm resize-none"></textarea>
                </div>
                <div class="flex-shrink-0 ml-3 flex">
                    <button class="inline-flex items-center p-1.5 border border-gray-300 dark:border-gray-600 rounded-full shadow-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all" title="Attach file">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                        </svg>
                    </button>
                    <button class="ml-2 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile View - Empty State -->
    <div class="md:hidden flex-1 bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden flex flex-col items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 dark:text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 dark:text-white">Select a conversation</h3>
        <p class="text-gray-500 dark:text-gray-400 text-center mt-2 px-6">Choose a conversation from the list to view messages</p>
    </div>
</div>

<!-- Mobile Message Detail View (Hidden by default) -->
<div id="mobileMessageView" class="fixed inset-0 bg-white dark:bg-gray-800 z-50 hidden">
    <!-- Mobile Thread Header -->
    <div class="sticky top-0 z-10 px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center">
        <button id="backToMessages" class="p-1 mr-2 text-gray-500 dark:text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
        <div class="flex items-center">
            <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 dark:text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
            </div>
            <div class="ml-2">
                <p class="text-sm font-medium text-gray-900 dark:text-white">Dr. Sarah Johnson</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">Cardiology</p>
            </div>
        </div>
        <div class="ml-auto flex space-x-2">
            <button class="p-1 text-gray-500 dark:text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
            </button>
            <button class="p-1 text-gray-500 dark:text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Mobile Messages Container -->
    <div class="overflow-y-auto h-[calc(100vh-8rem)] p-4">
        <!-- Same message content structure as desktop view -->
    </div>

    <!-- Mobile Message Input -->
    <div class="sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-3">
        <div class="flex items-end">
            <div class="flex-1">
                <textarea rows="1" placeholder="Type your message..." class="block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm resize-none"></textarea>
            </div>
            <div class="flex-shrink-0 ml-2 flex">
                <button class="p-1.5 text-gray-500 dark:text-gray-400" title="Attach file">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                    </svg>
                </button>
                <button class="ml-2 inline-flex items-center p-1.5 text-white bg-blue-600 rounded-full hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mobile conversation handling
        const mobileView = document.getElementById('mobileMessageView');
        const backButton = document.getElementById('backToMessages');
        const conversationItems = document.querySelectorAll('li a');

        // Show conversation on mobile when clicked
        conversationItems.forEach(item => {
            item.addEventListener('click', function(e) {
                if (window.innerWidth < 768) {
                    e.preventDefault();
                    mobileView.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden');
                }
            });
        });

        // Back button functionality
        if (backButton) {
            backButton.addEventListener('click', function() {
                mobileView.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            });
        }

        // Auto-resize textarea
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(textarea => {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';

                // Reset height if empty
                if (this.value.length === 0) {
                    this.style.height = 'auto';
                }
            });
        });
    });
</script>
{% endblock %}